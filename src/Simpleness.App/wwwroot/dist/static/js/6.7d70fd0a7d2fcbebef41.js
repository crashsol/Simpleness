webpackJsonp([6],{"U+X0":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("Dd8w"),a=r.n(n),i=r("Xxa5"),s=r.n(i),o=r("exGp"),l=r.n(o),d=r("vLgD");function c(e,t,r,n,a){return Object(d.a)({url:"api/department/update",method:"post",data:{id:e,name:t,description:r,order:n,pid:a}})}var m={data:function(){return{departTree:[],departments:[],filterText:"",form:{id:void 0,name:"",description:"",order:99,pid:""},formRules:{name:[{required:!0,trigger:"blur",message:"请输入部门名称"},{message:"最大长度80个字符",trigger:blur,max:80}],description:[{message:"最大长度255个字符",trigger:"blur",max:255}],pid:[{required:!0,trigger:"blur",message:"请选择上级部门"}]},dialogStatus:"",dialogFormVisible:!1,textMap:{create:"创建部门",update:"更新部门"},memberModel:{id:void 0,title:"",userIds:[],items:[]},currentNode:Object}},watch:{filterText:function(e){this.$refs.departmentTree.filter(e)}},methods:{filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},getDepartmentTree:function(){var e=this;return l()(s.a.mark(function t(){var r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(d.a)({url:"api/department/tree",method:"get"});case 2:r=t.sent,e.departTree=[],e.departTree.push(r);case 5:case"end":return t.stop()}},t,e)}))()},resetForm:function(){this.form={id:null,name:"",description:"",order:0}},handleCreate:function(e){var t=this;this.resetForm(),this.currentNode=e,this.form.pid=e.id,e.children?this.form.order=e.order+e.children.length:this.form.order=e.order+1,this.dialogStatus="create",this.dialogFormVisible=!0,this.$nextTick(function(){t.$refs.departmentForm.clearValidate()})},create:function(){var e,t=this;this.$refs.departmentForm.validate((e=l()(s.a.mark(function e(r){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=9;break}return e.next=3,i=t.form.name,s=t.form.description,o=t.form.order,l=t.form.pid,Object(d.a)({url:"api/department/create",method:"post",data:{name:i,description:s,order:o,pid:l}});case 3:n=e.sent,t.form.id=n,t.currentNode.children||t.$set(t.currentNode,"children",[]),t.currentNode.children.push(a()({},t.form,{label:t.form.name,children:[]})),t.dialogFormVisible=!1,t.$message({message:"创建成功",type:"success"});case 9:case"end":return e.stop()}var i,s,o,l},e,t)})),function(t){return e.apply(this,arguments)}))},handleUpdate:function(e,t){var r=this;console.log(t),this.form.id=t.id,this.form.pid=t.pid,this.form.order=t.order,this.form.description=t.description,this.form.name=t.label,this.currentNode=t,this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick(function(){r.$refs.departmentForm.clearValidate()})},update:function(){var e,t=this;this.$refs.departmentForm.validate((e=l()(s.a.mark(function e(r){var n,a,i,o,l,d;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.form,a=n.id,i=n.name,o=n.description,l=n.order,d=n.pid,console.log(t.form),e.next=4,c(a,i,o,l,d);case 4:return e.next=6,t.getDepartmentTree();case 6:t.dialogFormVisible=!1,t.$message({message:"更新成功",type:"success"});case 8:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))},handleDelete:function(e,t){var r=this,n="确定删除 "+t.label+" 部门";this.$confirm(n,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(l()(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n=t.id,Object(d.a)({url:"api/department/delete/"+n,method:"post"});case 2:return e.next=4,r.getDepartmentTree();case 4:r.$message({message:"删除成功",type:"success"});case 5:case"end":return e.stop()}var n},e,r)})))},handleMember:function(e){var t=this;return l()(s.a.mark(function r(){var n;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,a=e.id,Object(d.a)({url:"api/department/users/"+a,method:"get"});case 2:n=r.sent,t.memberModel.id=e.id,t.memberModel.title="设置 "+e.label+" ",t.memberModel.userIds=n.selectItems,t.memberModel.items=n.items;case 7:case"end":return r.stop()}var a},r,t)}))()},member:function(){var e=this;this.$confirm(this.memberModel.title,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(l()(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r=e.memberModel.id,n=e.memberModel.userIds,Object(d.a)({url:"api/department/users",method:"post",data:{id:r,userIds:n}});case 2:e.$message({message:"设置成功",type:"success"});case 3:case"end":return t.stop()}var r,n},t,e)}))).catch(function(){e.$message({message:"取消设置",type:"warning"})})}},mounted:function(){this.getDepartmentTree()}},u={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-row",{attrs:{gutter:30}},[r("el-col",{attrs:{span:14}},[r("el-input",{attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),r("el-tree",{ref:"departmentTree",staticStyle:{"padding-top":"20px"},attrs:{data:e.departTree,"default-expand-all":"","node-key":"id","expand-on-click-node":!1,"filter-node-method":e.filterNode},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,a=t.data;return r("span",{staticClass:"custom-tree-node"},[r("span",[e._v(e._s(n.label))]),e._v(" "),r("span",[r("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.handleCreate(a)}}},[e._v("\n              添加\n            ")]),e._v(" "),r("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.handleUpdate(n,a)}}},[e._v("\n              编辑\n            ")]),e._v(" "),r("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.handleDelete(n,a)}}},[e._v("\n              删除\n            ")]),e._v(" "),r("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.handleMember(a)}}},[e._v("\n              部门成员\n            ")])],1)])}}])})],1),e._v(" "),r("el-col",{attrs:{span:10}},[r("el-card",{attrs:{"body-style":{padding:"10px"}}},[r("div",{attrs:{slot:"header"},slot:"header"},[r("span",[e._v(e._s(e.memberModel.title)+"部门成员")]),e._v(" "),r("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.member}},[e._v("更新设置")])],1),e._v(" "),r("el-transfer",{attrs:{data:e.memberModel.items,filterable:"",titles:["未选择用户","已选择用户"]},model:{value:e.memberModel.userIds,callback:function(t){e.$set(e.memberModel,"userIds",t)},expression:"memberModel.userIds"}})],1)],1)],1),e._v(" "),r("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible,width:"60%"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[r("el-form",{ref:"departmentForm",attrs:{rules:e.formRules,model:e.form,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"部门名称",prop:"name"}},[r("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"部门描述",prop:"description"}},[r("el-input",{attrs:{type:"textarea",rows:"5"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"部门排序",prop:"order"}},[r("el-input",{model:{value:e.form.order,callback:function(t){e.$set(e.form,"order",t)},expression:"form.order"}})],1)],1),e._v(" "),r("span",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v(e._s(e.$t("table.cancel")))]),e._v(" "),"create"==e.dialogStatus?r("el-button",{attrs:{type:"primary"},on:{click:e.create}},[e._v(e._s(e.$t("table.confirm")))]):r("el-button",{attrs:{type:"primary"},on:{click:e.update}},[e._v(e._s(e.$t("table.confirm")))])],1)],1)],1)},staticRenderFns:[]};var p=r("VU/8")(m,u,!1,function(e){r("qoLg")},null,null);t.default=p.exports},n5Zw:function(e,t,r){(e.exports=r("FZ+f")(!1)).push([e.i,"\n.custom-tree-node {\n  -webkit-box-flex: 1;\n      -ms-flex: 1;\n          flex: 1;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: justify;\n      -ms-flex-pack: justify;\n          justify-content: space-between;\n  font-size: 14px;\n  padding-right: 8px;\n}\n",""])},qoLg:function(e,t,r){var n=r("n5Zw");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);r("rjj0")("bc652b32",n,!0)}});